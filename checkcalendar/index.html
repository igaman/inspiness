<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Check calendar</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="./style.css">
</head>
<body>
	<div id="root" class="container-fluid">
		<div class="row">
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/locale/fr.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const rootDiv = document.getElementById('root').getElementsByClassName('row');
			const url = 'http://polarfront.fr/wp-json/wp/v2/quotes';

			fetch(url)
			.then(response => response.json())
			.then((data) => {
				console.log(data);
				createTable(searchAndSort(data));
			})
			.catch((e) => console.error(e));

			function searchAndSort(quote) {
				const year = moment().format('YYYY');
				const day = moment().format('D');
				const month = (Number(moment().format('M')) - 1).toString();
				//diff 7200 milliseconds with the json
				let now = Number(new Date(year,month,day).getTime().toString().slice(0, -3)) + 7200;
				now = now.toString();
				//console.log('now ', now);
				const todayQuote = quote.filter(quote => quote.date_publish === now);
				const themeOrder = ['tech','politic','military','spirituality'];
				return newOrder = todayQuote.sort((x,y) => themeOrder.indexOf(x.theme) > themeOrder.indexOf(y.theme) ? 1 : -1);
			}

			function createTable(data) {
				let tableHtml = `<h2>${moment().format('dddd DD MMMM YYYY')}</h2>`
				tableHtml += data.map((elem) => {
					const QuoteImage = (img) => {
						const imageExtension = img.slice(-4);
						return img.split(imageExtension)[0] +'-300x300'+ imageExtension;
					}
					return `<div class="col-md-3">
								<h3><img class="image-quote" src="${QuoteImage(elem.thumbnail)}" alt="${elem.author}" /><b> ${elem.author}</b></h3>
								<h4><b>Title: </b>${elem.title.rendered}</h4>
								<p>${elem.content.rendered}</p>
								<h4><b>Theme: </b>${elem.theme.toUpperCase()}</h4>
							</div>`
				}).join('');
				//console.log(tableHtml);
				root.innerHTML = tableHtml;
			}
			//return moment().add(1,'days').format('YYYY-MM-DD');
		});
	</script>
</body>
</html>